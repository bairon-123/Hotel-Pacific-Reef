<ion-header class="site-header">
  <ion-toolbar color="light">
    <div class="container navbar">
      <div class="brand">
        <ion-icon name="desktop-outline"></ion-icon>
        <span>Check-in Recepción</span>
      </div>
      <nav class="menu">
        <a routerLink="/recepcionista" routerLinkActive="active">Dashboard</a>
        <a routerLink="/recepcionista/reservas">Reservas Hoy</a>
        <a routerLink="/recepcionista/checkin">Check-in</a>
        <a routerLink="/recepcionista/habitaciones">Habitaciones</a>
        <a routerLink="/recepcionista/pagos">Pagos</a>
        <a href="#" class="logout" (click)="logout($event)">Cerrar sesión</a>
      </nav>
    </div>
  </ion-toolbar>
</ion-header>


<ion-content class="ion-padding">
  <!-- Lector QR -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Escanear QR de Reserva</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="qr-scanner-container">
        <video #videoElement class="qr-video" [hidden]="!isScanning"></video>
        <canvas #canvasElement class="qr-canvas" [hidden]="true"></canvas>
        
        <div *ngIf="!isScanning" class="scan-placeholder">
          <ion-icon name="qr-code-outline" size="large"></ion-icon>
          <p>Presiona iniciar para escanear QR</p>
        </div>
      </div>

      <ion-button expand="block" (click)="toggleScan()" [color]="isScanning ? 'danger' : 'primary'">
        <ion-icon [name]="isScanning ? 'stop' : 'play'" slot="start"></ion-icon>
        {{ isScanning ? 'Detener Escaneo' : 'Iniciar Escaneo' }}
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- Búsqueda manual -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Búsqueda Manual</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-input 
          [(ngModel)]="busquedaManual" 
          placeholder="Buscar por nombre, email o ID"
          (ionInput)="buscarReservaManual()">
        </ion-input>
      </ion-item>

      <ion-list *ngIf="resultadosBusqueda.length">
        <ion-item *ngFor="let reserva of resultadosBusqueda" (click)="seleccionarReserva(reserva)">
          <ion-label>
            <h3>#{{ reserva.id }} • {{ reserva.datosHuesped?.nombreCompleto }}</h3>
            <p>{{ reserva.nombreHabitacion }} • {{ reserva.llegada | date:'dd/MM/yyyy' }}</p>
            <p [class]="reserva.estadoPago">{{ reserva.estadoPago | titlecase }}</p>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Detalles de reserva seleccionada -->
  <ion-card *ngIf="reservaSeleccionada">
    <ion-card-header>
      <ion-card-title>Detalles de Reserva #{{ reservaSeleccionada.id }}</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item>
          <ion-label>
            <h3>Huésped</h3>
            <p>{{ reservaSeleccionada.datosHuesped?.nombreCompleto }}</p>
            <p>{{ reservaSeleccionada.datosHuesped?.telefono }}</p>
            <p>{{ reservaSeleccionada.datosHuesped?.email }}</p>
          </ion-label>
        </ion-item>

        <ion-item>
          <ion-label>
            <h3>Habitación</h3>
            <p>{{ reservaSeleccionada.nombreHabitacion }}</p>
          </ion-label>
        </ion-item>

        <ion-item>
          <ion-label>
            <h3>Estado de Pago</h3>
            <p [class]="reservaSeleccionada.estadoPago">
              {{ reservaSeleccionada.estadoPago | titlecase }} ({{ reservaSeleccionada.porcentajePagado }}%)
            </p>
          </ion-label>
        </ion-item>

        <ion-item>
          <ion-label>
            <h3>QR Usado</h3>
            <p>{{ reservaSeleccionada.qrUsado ? 'SÍ ✅' : 'NO ❌' }}</p>
          </ion-label>
        </ion-item>
      </ion-list>

      <!-- Acciones -->
      <div class="actions">
        <ion-button 
          expand="block" 
          color="success" 
          [disabled]="reservaSeleccionada.qrUsado || reservaSeleccionada.estadoPago === 'pendiente'"
          (click)="procesarCheckin()">
          <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
          Confirmar Check-in
        </ion-button>

        <ion-button 
          expand="block" 
          color="warning" 
          *ngIf="reservaSeleccionada.estadoPago === 'pendiente'"
          (click)="irAPagos()">
          <ion-icon name="card-outline" slot="start"></ion-icon>
          Procesar Pago
        </ion-button>

        <ion-button 
          expand="block" 
          color="medium" 
          fill="outline"
          (click)="generarNuevoQR()">
          <ion-icon name="refresh-outline" slot="start"></ion-icon>
          Generar Nuevo QR
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>
</ion-content>