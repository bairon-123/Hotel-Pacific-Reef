<ion-header class="site-header">
  <ion-toolbar color="light">
    <div class="container navbar">
      <div class="brand">
        <ion-icon name="settings-outline"></ion-icon>
        <span>Admin • Habitaciones</span>
      </div>

      <nav class="menu">
        <a routerLink="/admin">Dashboard</a>
        <a routerLink="/admin/usuarios">Usuarios</a>
        <a routerLink="/admin/reservas">Reservas</a>
        <a routerLink="/admin/habitaciones" routerLinkActive="active">Habitaciones</a>
        <a routerLink="/admin/reportes">Reportes</a>
      </nav>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content class="site-content ion-padding">
  <ion-card>
    <ion-card-header>
      <ion-card-title>Gestión de habitaciones</ion-card-title>
      <ion-card-subtitle>Crear, editar o eliminar</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <ion-button color="primary" (click)="openAdd()">
        <ion-icon name="add-outline" slot="start"></ion-icon>
        Nueva habitación
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- Lista en tarjetas -->
  <div class="grid">
    <ion-card class="room" *ngFor="let r of rooms; trackBy: trackByIndex">
      <div class="cover">
        <img [src]="(r.imgs && r.imgs.length ? r.imgs[0] : 'https://dummyimage.com/800x500/eee/aaa&text=Sin+foto')" alt="foto">

        <ion-badge class="badge" [color]="r.disponible ? 'success' : 'medium'">
          {{ r.disponible ? 'Disponible' : 'No disponible' }}
        </ion-badge>
      </div>

      <ion-card-header>
        <ion-card-title>{{ r.nombre }}</ion-card-title>
        <ion-card-subtitle>{{ tipoLabel(r.tipo) }} • Cap: {{ r.capacidad || '-' }}</ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        <p class="desc">{{ r.descripcion || '—' }}</p>

        <div class="meta">
          <ion-badge color="primary">{{ currency(r.precioNoche) }}/noche</ion-badge>
          <ion-badge color="tertiary">Fotos: {{ (r.imgs && r.imgs.length) ? r.imgs.length : 0 }}</ion-badge>
        </div>

        <div class="actions">
          <ion-button size="small" fill="outline" (click)="openEdit(r)">
            <ion-icon name="pencil-outline" slot="start"></ion-icon> Editar
          </ion-button>
          <ion-button size="small" color="danger" (click)="confirmDelete(r)">
            <ion-icon name="trash-outline" slot="start"></ion-icon> Eliminar
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Modal Crear/Editar -->
  <ion-modal [isOpen]="isModalOpen" (willDismiss)="closeModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ mode === 'add' ? 'Nueva habitación' : 'Editar habitación' }}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeModal()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding modal-content">
        <ion-item lines="full">
          <ion-label position="stacked">Nombre</ion-label>
          <ion-input [(ngModel)]="form.nombre" placeholder="Ej: Premium Vista Mar"></ion-input>
        </ion-item>

        <ion-item lines="full">
          <ion-label position="stacked">Tipo</ion-label>
          <ion-segment [(ngModel)]="form.tipo">
            <ion-segment-button value="basic">Básica</ion-segment-button>
            <ion-segment-button value="medium">Medium</ion-segment-button>
            <ion-segment-button value="premium">Premium</ion-segment-button>
          </ion-segment>
        </ion-item>

        <ion-item lines="full">
          <ion-label position="stacked">Precio por noche (CLP)</ion-label>
          <ion-input type="number" min="0" [(ngModel)]="form.precioNoche"></ion-input>
        </ion-item>

        <ion-item lines="full">
          <ion-label position="stacked">Capacidad</ion-label>
          <ion-input type="number" min="1" [(ngModel)]="form.capacidad"></ion-input>
        </ion-item>

        <ion-item lines="full">
          <ion-label>Disponible</ion-label>
          <ion-toggle [(ngModel)]="form.disponible"></ion-toggle>
        </ion-item>

        <ion-item lines="full">
          <ion-label position="stacked">Descripción</ion-label>
          <ion-textarea rows="4" [(ngModel)]="form.descripcion" placeholder="Descripción corta"></ion-textarea>
        </ion-item>

        <div class="imgs-block">
          <div class="imgs-head">
            <h4>Imágenes</h4>
            <ion-button size="small" fill="outline" (click)="addImgField()">
              <ion-icon name="add-outline" slot="start"></ion-icon> URL
            </ion-button>
          </div>

          <div class="img-list">
            <div class="img-row" *ngFor="let url of form.imgs; let i = index; trackBy: trackByIndex">
              <ion-input [(ngModel)]="form.imgs[i]" placeholder="https://…"></ion-input>
              <ion-button color="medium" fill="clear" (click)="removeImgField(i)" [disabled]="form.imgs.length <= 1">
                <ion-icon name="remove-circle-outline"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>

        <ion-button expand="block" color="primary" (click)="save()">
          <ion-icon name="save-outline" slot="start"></ion-icon>
          {{ mode === 'add' ? 'Crear habitación' : 'Guardar cambios' }}
        </ion-button>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
