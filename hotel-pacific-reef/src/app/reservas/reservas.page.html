
<ion-header class="site-header">
  <ion-toolbar color="light">
    <div class="container navbar">
      <div class="brand">
        <ion-icon name="sparkles-outline"></ion-icon>
        <span>Hotel Pacific Reef</span>
      </div>
      <nav class="menu">
        <a routerLink="/home" routerLinkActive="active">{{ 'header.home' | translate }}</a>
        <a routerLink="/reservas" routerLinkActive="active">{{ 'header.reservas' | translate }}</a>
        <a routerLink="/perfil" routerLinkActive="active">{{ 'header.perfil' | translate }}</a>
        <span *ngIf="currentEmail" class="user-pill">{{ 'header.hello' | translate }} <b>{{ currentEmail }}</b></span>
        <a href="#" class="logout" (click)="logout($event)">{{ 'header.logout' | translate }}</a>
      </nav>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="site-content ion-padding">

  <!-- Filtros -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>{{ 'reservas.search' | translate }}</ion-card-title>
      <ion-card-subtitle>{{ 'reservas.minStay' | translate }}</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content class="filters-grid">
      <ion-item>
        <ion-label position="stacked">{{ 'reservas.arrival' | translate }}</ion-label>
        <ion-datetime
          [(ngModel)]="llegada"
          [min]="minDate"
          [max]="maxDate"
          presentation="date"
          (ionChange)="onFechaChange()">
        </ion-datetime>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">{{ 'reservas.departure' | translate }}</ion-label>
        <ion-datetime
          [(ngModel)]="salida"
          [min]="minDate"
          [max]="maxDate"
          presentation="date"
          (ionChange)="onFechaChange()">
        </ion-datetime>
      </ion-item>

      <!-- Indicador de política de horas -->
      <ion-text color="medium" class="ion-margin-top">
        {{ 'reservas.checkin' | translate }} <b>14:00</b> • {{ 'reservas.checkout' | translate }} <b>12:00</b>. {{ 'reservas.stay' | translate }} <b>{{ 'reservas.nights' | translate }}</b>.
      </ion-text>

      <ion-item>
        <ion-label>{{ 'reservas.roomType' | translate }}</ion-label>
        <ion-select [(ngModel)]="tipoSeleccionado" (ionChange)="filtrar()">
          <ion-select-option value="">{{ 'reservas.all' | translate }}</ion-select-option>
          <ion-select-option value="basic">{{ 'reservas.basic' | translate }}</ion-select-option>
          <ion-select-option value="medium">{{ 'reservas.medium' | translate }}</ion-select-option>
          <ion-select-option value="premium">{{ 'reservas.premium' | translate }}</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item>
        <ion-label>{{ 'reservas.onlyAvailable' | translate }}</ion-label>
        <ion-toggle [(ngModel)]="soloDisponibles" (ionChange)="filtrar()"></ion-toggle>
      </ion-item>

      <ion-text color="danger" *ngIf="errorMsg">{{ errorMsg }}</ion-text>
      <ion-note *ngIf="!errorMsg && noches > 0">
        {{ 'reservas.stay' | translate }}: <b>{{ noches }}</b> {{ noches === 1 ? ('reservas.nights' | translate) : ('reservas.nights' | translate) }} ({{ 'reservas.checkin' | translate }} 14:00 / {{ 'reservas.checkout' | translate }} 12:00)
      </ion-note>
    </ion-card-content>
  </ion-card>

  <!-- Lista habitaciones -->
  <ion-card *ngFor="let h of filtradas">

    <div class="gallery">
      <img class="hero-img"
           [src]="getCover(h)"
           [alt]="h.nombre"
           (click)="openLightbox(h, getIndex(h))" />

      <div class="thumbs" *ngIf="(h.imgs || []).length > 1">
        <button class="thumb"
                *ngFor="let img of (h.imgs || []); index as i"
                [class.active]="getIndex(h) === i"
                (click)="showImg(h, i)"
                type="button"
                [attr.aria-label]="'Ver imagen ' + (i+1) + ' de ' + h.nombre">
          <img [src]="img" [alt]="h.nombre + ' foto ' + (i+1)" />
        </button>
      </div>
    </div>

    <ion-card-header>
      <ion-card-title>{{ h.nombre }}</ion-card-title>
      <ion-card-subtitle>{{ h.camas || '—' }} • Cap: {{ h.capacidad || '—' }}</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <p>{{ h.descripcion }}</p>

      <div class="price-line">
        <ion-badge color="primary">{{ currency(h.precioNoche) }}{{ 'reservas.perNight' | translate }}</ion-badge>
        <ion-badge color="success" *ngIf="h.disponible">{{ 'reservas.available' | translate }}</ion-badge>
        <ion-badge color="medium" *ngIf="!h.disponible">{{ 'reservas.notAvailable' | translate }}</ion-badge>
      </div>

      <div class="amenities" *ngIf="(h.amenities || []).length">
        <ion-chip *ngFor="let a of (h.amenities || [])" color="medium" outline>{{ a }}</ion-chip>
      </div>

      <ion-button
        expand="block"
        color="success"
        [disabled]="!h.disponible || noches <= 0"
        (click)="reservar(h)">
        {{ 'reservas.book' | translate }}
      </ion-button>
    </ion-card-content>
  </ion-card>


  <ion-modal [isOpen]="lightboxOpen" (didDismiss)="closeLightbox()">
    <div class="lightbox">
      <button class="lb-btn close" (click)="closeLightbox()" aria-label="{{ 'login.close' | translate }}">
        <ion-icon name="close"></ion-icon>
      </button>

      <button class="lb-btn nav prev"
              (click)="prev()"
              [disabled]="lightboxImgs.length <= 1"
              aria-label="{{ 'Anterior' | translate }}">
        <ion-icon name="chevron-back"></ion-icon>
      </button>

      <button class="lb-btn nav next"
              (click)="next()"
              [disabled]="lightboxImgs.length <= 1"
              aria-label="{{ 'Siguiente' | translate }}">
        <ion-icon name="chevron-forward"></ion-icon>
      </button>

      <div class="stage" *ngIf="lightboxImgs.length" (click)="toggleZoom()">
        <img [src]="lightboxImgs[lightboxIndex]"
             [alt]="'Imagen '+(lightboxIndex+1)+' de '+lightboxImgs.length"
             [class.zoom]="zoomed" />
      </div>

      <div class="lb-thumbs" *ngIf="lightboxImgs.length > 1">
        <button *ngFor="let img of lightboxImgs; index as i"
                type="button"
                class="thumb"
                [class.active]="i === lightboxIndex"
                (click)="lightboxIndex = i">
          <img [src]="img" [alt]="'Miniatura '+(i+1)" />
        </button>
      </div>
    </div>
  </ion-modal>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p>{{ 'home.footer' | translate }}</p>
    </div>
  </footer>
</ion-content>
