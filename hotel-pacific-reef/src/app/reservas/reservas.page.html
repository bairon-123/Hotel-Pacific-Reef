<ion-header class="site-header">
  <ion-toolbar color="light">
    <div class="container navbar">
      <div class="brand">
        <ion-icon name="sparkles-outline"></ion-icon>
        <span>Hotel Pacific Reef</span>
      </div>

      <!-- Menú a la derecha -->
      <nav class="menu">
        <a routerLink="/home" routerLinkActive="active">Home</a>
        <a routerLink="/reservas" routerLinkActive="active">Reservas</a>
        <a routerLink="/admin" routerLinkActive="active">Admin</a>
      </nav>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="site-content ion-padding">

  <!-- BUSCADOR -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Buscar disponibilidad</ion-card-title>
      <ion-card-subtitle>Selecciona rango de fechas y tipo de habitación</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col sizeMd="6" size="12">
            <ion-item>
              <ion-label position="stacked">Rango de fechas</ion-label>
              <!-- Un solo calendario -->
              <ion-datetime
                presentation="date-range"
                [(ngModel)]="rangoFechas"
                (ionChange)="calcularNoches()">
              </ion-datetime>
            </ion-item>
          </ion-col>

          <ion-col sizeMd="6" size="12">
            <ion-item>
              <ion-label position="stacked">Tipo de habitación</ion-label>
              <ion-select [(ngModel)]="tipo" (ionChange)="buscar()">
                <ion-select-option value="">Cualquiera</ion-select-option>
                <ion-select-option value="single">Single</ion-select-option>
                <ion-select-option value="doble">Doble</ion-select-option>
                <ion-select-option value="suite">Suite</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>
        </ion-row>
      </ion-grid>

      <ion-button expand="block" (click)="buscar()" color="primary">
        <ion-icon slot="start" name="search-outline"></ion-icon>
        Buscar
      </ion-button>

      <ion-note color="medium" *ngIf="noches > 0">
        Noches: <b>{{ noches }}</b>
      </ion-note>
    </ion-card-content>
  </ion-card>

  <!-- RESULTADOS -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Habitaciones disponibles</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <ion-list *ngIf="filtradas.length; else vacio">
        <ion-item *ngFor="let h of filtradas">
          <ion-label>
            <h2>Hab. {{ h.id }} — {{ h.tipo | uppercase }}</h2>
            <ion-badge color="primary">{{ currency(h.precioNoche) }}</ion-badge>
            <ion-note color="medium" *ngIf="noches>0">
              × {{ noches }} = <b>{{ currency(h.precioNoche*noches) }}</b>
            </ion-note>
          </ion-label>
          <ion-button [disabled]="noches<=0" (click)="reservar(h)">Reservar</ion-button>
        </ion-item>
      </ion-list>

      <ng-template #vacio>
        <ion-text color="medium">No hay resultados para las fechas seleccionadas.</ion-text>
      </ng-template>
    </ion-card-content>
  </ion-card>

  <!-- RESERVAS LOCALES -->
  <ion-card *ngIf="reservas.length">
    <ion-card-header>
      <ion-card-title>Mis reservas</ion-card-title>
      <ion-card-subtitle>Guardadas en este dispositivo</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let r of reservas">
          <ion-label>
            <h3>#{{ r.id }} • Hab. {{ r.habitacionId }}</h3>
            <p>{{ r.desde }} → {{ r.hasta }} • {{ r.noches }} noches</p>
            <p>
              Total: <b>{{ currency(r.total) }}</b> •
              Anticipo: <b>{{ currency(r.anticipo) }}</b> •
              Saldo: <b>{{ currency(r.saldo) }}</b>
            </p>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container">
      <p>© 2025 Hotel Pacific Reef — Reservas</p>
    </div>
  </footer>
</ion-content>
