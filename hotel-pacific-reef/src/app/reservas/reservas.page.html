<ion-header class="site-header">
  <ion-toolbar color="light">
    <div class="container navbar">
      <div class="brand">
        <ion-icon name="sparkles-outline"></ion-icon>
        <span>Hotel Pacific Reef</span>
      </div>

      <!-- Menú derecha -->
      <nav class="menu">
        <a routerLink="/home" routerLinkActive="active">Home</a>
        <a routerLink="/reservas" routerLinkActive="active">Reservas</a>
        <a routerLink="/perfil" routerLinkActive="active">Perfil</a>
        <span *ngIf="currentEmail" class="user-pill" title="{{ currentEmail }}">
          Hola, <b>{{ currentEmail }}</b>
        </span>
        <a href="#" class="logout" (click)="logout($event)">Cerrar sesión</a>
      </nav>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="site-content ion-padding">

  <ion-card>
    <ion-card-header>
      <ion-card-title>Buscar disponibilidad</ion-card-title>
      <ion-card-subtitle>Mínimo 5 días de anticipación</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col sizeMd="4" size="12">
            <ion-item lines="full">
              <ion-label position="stacked">Llegada</ion-label>
              <ion-datetime
                presentation="date"
                [(ngModel)]="llegada"
                [min]="minDate"
                [max]="maxDate"
                (ionChange)="onFechaChange()">
              </ion-datetime>
            </ion-item>
          </ion-col>

          <ion-col sizeMd="4" size="12">
            <ion-item lines="full">
              <ion-label position="stacked">Salida</ion-label>
              <ion-datetime
                presentation="date"
                [(ngModel)]="salida"
                [min]="llegada ? llegada : minDate"
                [max]="maxDate"
                (ionChange)="onFechaChange()">
              </ion-datetime>
            </ion-item>
          </ion-col>

          <ion-col sizeMd="4" size="12">
            <ion-item lines="full">
              <ion-label position="stacked">Tipo de habitación</ion-label>
              <ion-select [(ngModel)]="tipoSeleccionado" (ionChange)="filtrar()">
                <ion-select-option value="">Cualquiera</ion-select-option>
                <ion-select-option value="basic">Básica</ion-select-option>
                <ion-select-option value="medium">Medium</ion-select-option>
                <ion-select-option value="premium">Premium</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>
        </ion-row>
      </ion-grid>

      <ion-text color="danger" *ngIf="errorMsg">{{ errorMsg }}</ion-text>
      <ion-note color="medium" *ngIf="!errorMsg && noches>0">
        Noches: <b>{{ noches }}</b>
      </ion-note>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Habitaciones disponibles</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <ion-list *ngIf="filtradas.length; else nores">
        <ion-item *ngFor="let h of filtradas" class="room-item">
          <ion-thumbnail slot="start" class="thumb">
            <img [src]="h.imgs[0]" alt="Foto {{h.nombre}}">
          </ion-thumbnail>

          <ion-label>
            <h2>{{ h.nombre }}</h2>
            <div class="line">
              <ion-badge color="primary">{{ currency(h.precioNoche) }} / noche</ion-badge>
              <ion-note color="medium">• {{ h.camas }} • Cap: {{ h.capacidad }}</ion-note>
            </div>
            <p class="desc">{{ h.descripcion }}</p>

            <div class="amenities">
              <ion-chip *ngFor="let a of h.amenities" [outline]="true" color="medium">{{ a }}</ion-chip>
            </div>

            <div class="mini-gallery">
              <img *ngFor="let img of h.imgs; let i=index"
                   [src]="img"
                   [alt]="h.nombre + ' ' + (i+1)"
                   loading="lazy"
                   decoding="async">
            </div>
          </ion-label>

          <ion-button [disabled]="noches<=0 || !!errorMsg" (click)="reservar(h)" slot="end">
            Elegir {{ h.tipo | titlecase }}
          </ion-button>
        </ion-item>
      </ion-list>

      <ng-template #nores>
        <ion-text color="medium">Selecciona llegada y salida para ver disponibilidad.</ion-text>
      </ng-template>
    </ion-card-content>
  </ion-card>

  <footer class="footer">
    <div class="container">
      <p>© 2025 Hotel Pacific Reef — Todos los derechos reservados</p>
    </div>
  </footer>
</ion-content>
