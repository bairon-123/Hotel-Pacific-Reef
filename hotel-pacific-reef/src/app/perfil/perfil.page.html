<ion-header class="site-header">
  <ion-toolbar color="light">
    <div class="container navbar">
      <div class="brand">
        <ion-icon name="sparkles-outline"></ion-icon>
        <span>Hotel Pacific Reef</span>
      </div>

      <nav class="menu">
        <a routerLink="/home" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Home</a>
        <a routerLink="/reservas" routerLinkActive="active">Reservas</a>
        <a routerLink="/perfil" routerLinkActive="active">Perfil</a>
        <span *ngIf="email" class="user-pill" [title]="email">Hola, <b>{{ email }}</b></span>
        <a href="#" class="logout" (click)="logout($event)" aria-label="Cerrar sesiÃ³n" title="Cerrar sesiÃ³n">Cerrar sesiÃ³n</a>
      </nav>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="site-content ion-padding page-content">
  <!-- Datos de la cuenta -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Mi perfil</ion-card-title>
      <ion-card-subtitle>Datos de tu cuenta</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item lines="full">
          <ion-label>
            <h2>Correo</h2>
            <p>{{ email }}</p>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Mis reservas -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Mis reservas</ion-card-title>
      <ion-card-subtitle>Guardadas en este dispositivo</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <ion-list *ngIf="reservas.length; else sinReservas">
        <ion-item *ngFor="let r of reservas; trackBy: trackById" class="res-item">
          <ion-label>
            <h3>#{{ r.id }} â€¢ {{ r.nombreHabitacion }} ({{ r.tipo | titlecase }})</h3>
            <p>ðŸ—“ {{ r.llegada }} â†’ {{ r.salida }} â€¢ {{ r.noches }} noche(s)</p>
            <p>ðŸ’µ {{ currency(r.precioNoche) }} / noche â€¢ Total: <b>{{ currency(r.total) }}</b></p>
          </ion-label>

          <ion-buttons slot="end">
            <ion-button fill="clear" color="primary" (click)="abrirEditar(r)" aria-label="Editar reserva" title="Editar reserva">
              <ion-icon name="create-outline" slot="start"></ion-icon>
              Editar
            </ion-button>
            <ion-button fill="clear" color="danger" (click)="borrarReserva(r)" aria-label="Eliminar reserva" title="Eliminar reserva">
              <ion-icon name="trash-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-item>
      </ion-list>

      <ng-template #sinReservas>
        <ion-text color="medium">
          AÃºn no tienes reservas. Ve a <a routerLink="/reservas">Reservas</a> para crear una.
        </ion-text>
      </ng-template>
    </ion-card-content>
  </ion-card>

  <!-- Modal: Editar fechas de la reserva -->
  <ion-modal [isOpen]="editOpen" (willDismiss)="cerrarEditar()" [backdropDismiss]="false">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Editar fechas</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="cerrarEditar()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">
        <ion-item>
          <ion-label position="stacked">Nueva llegada</ion-label>
          <ion-datetime
            [(ngModel)]="editLlegada"
            [min]="minDate"
            [max]="maxDate"
            presentation="date"
            aria-label="Seleccionar nueva fecha de llegada">
          </ion-datetime>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Nueva salida</ion-label>
          <ion-datetime
            [(ngModel)]="editSalida"
            [min]="minDate"
            [max]="maxDate"
            presentation="date"
            aria-label="Seleccionar nueva fecha de salida">
          </ion-datetime>
        </ion-item>

        <ion-text color="danger" *ngIf="editError">{{ editError }}</ion-text>

        <ion-button
          expand="block"
          color="primary"
          class="ion-margin-top"
          [disabled]="!puedeGuardarEdicion()"
          (click)="guardarEdicion()">
          Guardar cambios
        </ion-button>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p>Â© 2025 Hotel Pacific Reef â€” Todos los derechos reservados</p>
    </div>
  </footer>
</ion-content>
