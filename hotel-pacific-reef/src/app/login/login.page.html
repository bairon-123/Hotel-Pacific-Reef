<ion-content class="login-bg" [fullscreen]="true">
  <div class="bg-overlay"></div>

  <div class="login-wrap">
    <div class="card">

      <div class="brand">
        <div class="logo">H</div>
        <div class="txt">
          <b>HOTEL</b><span>PACIFIC REEF</span>
        </div>
      </div>
      <h2>Inicia sesión</h2>

      <!-- Email -->
      <ion-item lines="none" class="field field-lg">
        <ion-input
          type="email"
          placeholder="correo@ejemplo.com"
          [(ngModel)]="email"
          autocomplete="email"
          inputmode="email">
        </ion-input>
        <span slot="end" class="suffix-badge" aria-hidden="true">
          <ion-icon name="mail-outline"></ion-icon>
        </span>
      </ion-item>

      <!-- Password -->
      <ion-item lines="none" class="field field-lg">
        <ion-input
          #passInput
          [type]="showPass ? 'text' : 'password'"
          placeholder="Contraseña"
          [(ngModel)]="password"
          autocomplete="current-password">
        </ion-input>
        <button class="suffix-badge btn-eye" type="button" slot="end" (click)="showPass=!showPass"
                [attr.aria-label]="showPass ? 'Ocultar contraseña' : 'Mostrar contraseña'">
          <ion-icon [name]="showPass ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
        </button>
      </ion-item>

      <!-- captcha -->
      
      <div class="captcha-block">
        <label class="captcha-label">Verificación</label>
        <div class="captcha-row">
          <img class="captcha-img"
               [src]="captchaImage"
               alt="Texto CAPTCHA" />
          <ion-input
            [(ngModel)]="captchaInput"
            placeholder="Escribe el texto"
            aria-label="Texto del CAPTCHA"
            (ionInput)="captchaError=''"
            (ionBlur)="checkCaptchaEmpty()"
          ></ion-input>
          <ion-button fill="clear" size="small" (click)="regenCaptcha()" aria-label="Actualizar captcha">
            <ion-icon name="refresh-outline"></ion-icon>
          </ion-button>
        </div>
        <ion-text color="danger" *ngIf="captchaError">{{ captchaError }}</ion-text>
      </div>

      <ion-button expand="block" class="btn-primary" (click)="onLogin()" [disabled]="isLoading">
        <ion-spinner *ngIf="isLoading" name="dots"></ion-spinner>
        <span *ngIf="!isLoading">INGRESAR</span>
      </ion-button>

      <div class="links">
        <a (click)="openRegister($event)">Crear cuenta</a>
        <a (click)="forgot($event)">¿Olvidaste tu contraseña?</a>
      </div>

      <small class="foot">© 2025 Hotel Pacific Reef</small>
    </div>
  </div>

  <!-- Modal registro -->
  <ion-modal [isOpen]="registerOpen" (willDismiss)="registerOpen=false">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Crear cuenta</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="registerOpen=false">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">
        <ion-item lines="none" class="field field-lg">
          <ion-input type="email" placeholder="correo@ejemplo.com" [(ngModel)]="regEmail"></ion-input>
          <span slot="end" class="suffix-badge"><ion-icon name="mail-outline"></ion-icon></span>
        </ion-item>

        <ion-item lines="none" class="field field-lg">
          <ion-input [type]="regShowPass ? 'text' : 'password'"
                     placeholder="Contraseña (8+ con may/min/num)"
                     [(ngModel)]="regPass"></ion-input>
          <button class="suffix-badge btn-eye" type="button" slot="end" (click)="regShowPass=!regShowPass">
            <ion-icon [name]="regShowPass ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
          </button>
        </ion-item>

        <ion-item lines="none" class="field field-lg">
          <ion-input [type]="regShowPass ? 'text' : 'password'"
                     placeholder="Repetir contraseña"
                     [(ngModel)]="regPass2"></ion-input>
          <span slot="end" class="suffix-badge"><ion-icon name="lock-closed-outline"></ion-icon></span>
        </ion-item>

        <ion-button expand="block" color="success" class="btn-primary alt" (click)="onRegister()" [disabled]="isLoading">
          <ion-spinner *ngIf="isLoading" name="dots"></ion-spinner>
          <span *ngIf="!isLoading">Crear cuenta</span>
        </ion-button>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
